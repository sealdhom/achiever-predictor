<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Achiever Predictor — Self-evaluation</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial; margin:0; background:linear-gradient(180deg,#071029 0%, #071830 60%); color:#e6eef8; min-height:100vh; padding:2rem}
    .container{max-width:920px;margin:0 auto}
    header{display:flex;gap:1rem;align-items:center;margin-bottom:1rem}
    h1{font-size:1.5rem;margin:0}
    p.lead{margin:0;color:var(--muted)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); padding:1rem;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.7);}
    form.questions{display:grid;grid-template-columns:1fr;gap:1rem;margin-top:1rem}
    .q{display:flex;flex-direction:column;gap:0.5rem;padding:0.75rem;border-radius:8px;background:var(--glass);}
    .q label{font-weight:600}
    .scale{display:flex;gap:0.5rem;align-items:center}
    .scale input[type=range]{flex:1}
    .scale .val{min-width:36px;text-align:center;background:rgba(255,255,255,0.04);padding:0.25rem 0.5rem;border-radius:6px}
    .controls{display:flex;gap:0.5rem;margin-top:1rem}
    button{background:var(--accent);border:none;color:white;padding:0.6rem 0.9rem;border-radius:10px;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);}
    .results{margin-top:1rem;display:grid;gap:1rem}
    .bar{height:14px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden}
    .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5eead4);border-radius:inherit}
    .result-card{padding:1rem;border-radius:10px;background:linear-gradient(90deg, rgba(12,20,30,0.6), rgba(8,12,20,0.4));}
    .summary{display:flex;justify-content:space-between;align-items:center;gap:1rem}
    .tag{padding:0.25rem 0.5rem;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:700}
    footer{margin-top:2rem;color:var(--muted);font-size:0.9rem;text-align:center}

    /* FONT SIZE CONTROLLERS */
    .prediction-title{
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 8px;
    }
    .interpretation-title{
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 6px;
    }

    @media(min-width:880px){.questions{grid-template-columns:repeat(2,1fr)} }
    /* center header container content */
    header > div { width:100%; text-align:center }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="text-align:center;font-size:2.3rem">Achiever Predictor</h1>
        <p class="lead">Answer the 24 short questions. No login required. Get a percentage-based prediction whether you are a <strong>High</strong>, <strong>Neutral</strong>, or <strong>Low</strong> achiever.</p>
      </div>
    </header>

    <section class="card">
      <form id="quiz" class="questions" autocomplete="off">
        <!-- questions inserted by JS -->
      </form>

      <div class="controls">
        <button id="predict">Predict</button>
        <button id="reset" type="button" class="secondary">Reset</button>
        <div style="margin-left:auto;color:var(--muted);align-self:center">Scale: 1 (Strongly Disagree) — 5 (Strongly Agree)</div>
      </div>

      <div id="output" class="results" aria-live="polite" style="display:none">
        <!-- Results will appear here -->
      </div>

    </section>

    <footer>
      This is a simple, client-side predictive tool for self-evaluation and educational use only. It does not store data.
    </footer>
  </div>

  <script>
    // ----------------------------
    // 24 question texts (same order used in training)
    // ----------------------------
    const questions = [
      "On the whole, I am satisfied with myself.",
      "I feel that I have a number of good qualities.",
      "I am able to do things as well as most other people.",
      "I feel I do not have much to be proud of.",
      "I certainly feel useless at times.",
      "I take a positive attitude toward myself.",
      "I wish I could have more respect for myself.",
      "All in all, I am inclined to feel that I am a failure.",
      "I feel that I’m a person of worth.",
      "I feel good about myself most of the time.",
      "I manage my study time effectively.",
      "I review my notes regularly even without exams.",
      "I am motivated to perform well in my studies.",
      "I set academic goals and work hard to achieve them.",
      "I often feel stressed because of academic pressure.",
      "I can manage my stress effectively.",
      "My classmates or friends encourage me to do my best in school.",
      "I study or collaborate with peers to understand lessons better.",
      "My family provides emotional or financial support for my studies.",
      "My parents or guardians express pride in my academic achievements.",
      "I get enough sleep (7–8 hours) during weekdays.",
      "I feel well-rested and alert during classes.",
      "I spend more than 4 hours a day on social media.",
      "My social media use affects my study time."
    ];

    // ----------------------------
    // StandardScaler parameters (means & scales) - copied from your Python output
    // ----------------------------
    const means = [2.64,2.58,2.59,3.17,3.09,2.47,2.39,3.44,2.31,2.54,2.76,3.25,2.55,2.55,2.24,2.67,2.37,2.65,2.04,2.42,3.26,3.05,2.22,2.36];
    const scales = [1.034601372510205,0.8852118390532291,0.9496841580230766,1.1229870880824944,1.2007914056987583,1.053138167573467,1.0573079021741965,1.1341957503006261,1.0648474069086145,0.9425497334358544,1.0111379727811631,0.9733961166965892,0.9420721840708386,1.0988630487917956,1.1586198686368194,0.970103087305674,1.0738249391777042,1.1608186766243902,1.1568923891183658,1.1329607230614838,1.1884443613396463,0.9937303457175894,1.1452510641776328,1.204325537385968];

    // ----------------------------
    // KMeans centroids (3 x 24) - copied from your Python output
    // NOTE: these are on the standardized (z) scale
    // ----------------------------
    const centroids = [
      [-0.794333164109615, -0.7236754326413162, -0.6212591786601785, 0.1724297328894481, 0.2783517792150783, -0.6189294072591014, -0.28287966870943965, 0.44030665717233713, -0.5756977939308762, -0.6372141854167053, -0.8415360849010958, -0.6304076553324038, -0.8733165957327613, -0.6935543177643176, 0.002092353575029347, -0.659411332741594, -0.5421006636025603, -0.6643691532038163, -0.5846383317285659, -0.5044439227961978, -0.6012443474762247, -0.5992113937353474, -0.21855734356620296, 0.3552849911391189],
      [0.1992592042031266, -0.017958905649566245, -0.027269525008551856, -0.01438471227788464, -0.20307120178317395, -0.1541181369218298, -0.2476051406184799, 0.01899007427311615, -0.24296246301527794, 0.05277555971742791, 0.2627149140788104, 0.296345479002412, 0.12384047490133097, -0.05716864616531065, -0.4727109576816582, -0.003436060947492805, -0.1296587219676489, 0.14689014223019256, -0.3005398868232456, -0.14439136349554257, 0.36375930280857555, 0.38833214418824347, -0.32643161446403113, -0.6395749208542733],
      [0.6586387661319768, 0.8779173784820178, 0.7701808703971226, -0.18318490737551024, -0.045208280162635346, 0.9441170635536315, 0.6782724839832928, -0.5453833065478088, 1.0169129734755258, 0.6774936174918422, 0.6258860411665202, 0.33021353374554474, 0.8567738977867594, 0.8970310602382009, 0.6559528457717384, 0.7819492984794583, 0.8195004305579564, 0.5784095181695873, 1.107647161898188, 0.7956397367357388, 0.20194466632789249, 0.16532222749732073, 0.7122580464922101, 0.47210775734734783]
    ];

    // ----------------------------
    // Cluster label mapping (Python used 0:Achiever,1:Neutral,2:Not Achiever)
    // but user requested "High/Neutral/Low" wording — mapping below:
    // ----------------------------
    const labelMap = {
      0: "High Achiever",
      1: "Neutral Achiever",
      2: "Low Achiever"
    };

    // ----------------------------
    // Build the form dynamically (sliders)
    // ----------------------------
    const form = document.getElementById('quiz');
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    questions.forEach((q, i) => {
      const div = document.createElement('div');
      div.className = 'q';
      div.innerHTML = `
        <label for="q${i+1}">${i+1}. ${escapeHtml(q)}</label>
        <div class="scale">
          <span style="width:36px;text-align:center;color:var(--muted)">1</span>
          <input type="range" id="q${i+1}" name="q${i+1}" min="1" max="5" value="3" aria-label="Question ${i+1} slider">
          <span style="width:36px;text-align:center;color:var(--muted)">5</span>
          <div class="val" id="v${i+1}">3</div>
        </div>
      `;
      form.appendChild(div);
    });

    // Update displayed value when slider moves
    questions.forEach((_, i) => {
      const el = document.getElementById(`q${i+1}`);
      const val = document.getElementById(`v${i+1}`);
      el.addEventListener('input', () => val.textContent = el.value);
    });

    // ----------------------------
    // ML inference functions (JS)
    // ----------------------------
    function scaleVector(arr){
      // arr: array of raw answers (numbers 1..5)
      // returns standardized vector: (x - mean) / scale
      const z = [];
      for(let i=0;i<arr.length;i++){
        z.push((arr[i] - means[i]) / scales[i]);
      }
      return z;
    }

    function euclidean(a,b){
      let s=0;
      for(let i=0;i<a.length;i++){
        const d = a[i]-b[i];
        s += d*d;
      }
      return Math.sqrt(s);
    }

    function softmaxFromDistances(distances){
      // Convert distances to similarities and then softmax.
      // similarity = exp(-alpha * distance). alpha chosen to make scores >0.
      const alpha = 1.0; // you can tweak alpha if desired; alpha=1 is reasonable
      const raw = distances.map(d => Math.exp(-alpha * d));
      const sum = raw.reduce((a,b)=>a+b,0);
      return raw.map(r => r / sum);
    }

    function predictFromAnswers(answers){
      // answers: array length 24 of ints 1..5
      const z = scaleVector(answers); // standardized vector
      const distances = centroids.map(c => euclidean(z,c));
      const probs = softmaxFromDistances(distances); // array length 3
      // find best (smallest distance / highest prob)
      let bestIdx = 0;
      for(let i=1;i<probs.length;i++){
        if(probs[i] > probs[bestIdx]) bestIdx = i;
      }
      return {
        cluster: bestIdx,
        label: labelMap[bestIdx],
        probs,
        distances,
        standardized: z
      };
    }

    function formatPercent(p){ return (p*100).toFixed(1) + '%'; }

    // ----------------------------
    // Display results logic
    // ----------------------------
    function showResults({cluster,label,probs,distances}){
      const out = document.getElementById('output');
      out.style.display = 'block';
      out.innerHTML = '';

      const card = document.createElement('div'); card.className='result-card';

      const header = document.createElement('div');
      header.className = 'summary';
      header.innerHTML = `
        <div>
          <div class="prediction-title">Prediction Result:</div>
          <div class="tag" style="font-size:1.1rem;padding:6px 12px">${label}</div>
        </div>
        <div style="text-align:left;color:var(--muted);max-width:420px">
          <div class="interpretation-title">Interpretation</div>
          <div id="interp">${interpretation(label)}</div>
        </div>
      `;
      card.appendChild(header);

      // Add probability bars for each label in the requested order: High, Neutral, Low
      const ordered = [
        {label: 'High Achiever', p: probs[0]},
        {label: 'Neutral Achiever', p: probs[1]},
        {label: 'Low Achiever', p: probs[2]}
      ];

      ordered.forEach(item => {
        const row = document.createElement('div');
        row.style.display='grid';
        row.style.gridTemplateColumns='1fr 70px';
        row.style.alignItems='center';
        row.style.gap='10px';
        row.style.marginTop='12px';
        const left = document.createElement('div');
        left.innerHTML = `<div style="font-weight:700">${item.label}</div>
                          <div class="bar" style="margin-top:8px"><i style="width:${(item.p*100).toFixed(1)}%"></i></div>`;
        const right = document.createElement('div'); right.style.textAlign='right';
        right.innerHTML = `<div style="font-weight:800">${formatPercent(item.p)}</div>`;
        row.appendChild(left); row.appendChild(right);
        card.appendChild(row);
      });

      // Optional: show raw distances (collapsed)
      const details = document.createElement('div');
      details.style.marginTop = '10px';
      details.style.color = 'var(--muted)';
      details.style.fontSize = '0.9rem';
      details.innerHTML = `<div style="font-weight:700;margin-bottom:6px">Model distances (lower = closer)</div>
        <div>Cluster 0: ${distances[0].toFixed(3)} · Cluster 1: ${distances[1].toFixed(3)} · Cluster 2: ${distances[2].toFixed(3)}</div>`;
      card.appendChild(details);

      out.appendChild(card);
      card.scrollIntoView({behavior:'smooth'});
    }

    function interpretation(label){
      if(label === 'High Achiever') return 'Your responses align closely with students who show strong study habits, motivation, and self-efficacy. Keep maintaining routines and seeking feedback to stay on track.';
      if(label === 'Neutral Achiever') return 'You show a balanced set of strengths and areas for growth. Focus on regular review, time management, and stress management to improve consistency.';
      return 'Your responses are more similar to students who may struggle with some study habits or support; consider small changes like structured schedules, peer study, and using feedback to improve.';
    }

    // ----------------------------
    // Event handlers
    // ----------------------------
    document.getElementById('predict').addEventListener('click', (e)=>{
      e.preventDefault();
      const answers = [];
      for(let i=1;i<=questions.length;i++){
        const v = parseInt(document.getElementById('q'+i).value,10);
        if(isNaN(v)){ alert('Please answer all questions.'); return; }
        answers.push(v);
      }
      const out = predictFromAnswers(answers);
      showResults(out);
    });

    document.getElementById('reset').addEventListener('click', ()=>{
      for(let i=1;i<=questions.length;i++){
        const el = document.getElementById('q'+i);
        el.value = 3;
        document.getElementById('v'+i).textContent = '3';
      }
      document.getElementById('output').style.display='none';
    });

    // Accessibility: keyboard increment for sliders
    document.addEventListener('keydown', (e)=>{
      const active = document.activeElement;
      if(active && active.type === 'range'){
        if(e.key === 'ArrowLeft' || e.key === 'ArrowDown'){ active.value = Math.max(parseInt(active.min), parseInt(active.value)-1); active.dispatchEvent(new Event('input')); }
        if(e.key === 'ArrowRight' || e.key === 'ArrowUp'){ active.value = Math.min(parseInt(active.max), parseInt(active.value)+1); active.dispatchEvent(new Event('input')); }
      }
    });
  </script>
</body>
</html>
